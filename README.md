# Thread Synchronization Interactive Lab Â· åŸ·è¡Œç·’åŒæ­¥äº’å‹•æ•™å­¸

> Interactive mutex & semaphore playground with Zephyr-style APIs  
> ä½¿ç”¨ Mutex / Semaphore çš„äº’å‹•å¼æ•™å­¸å¯¦é©—å®¤ï¼Œæ­é… Zephyr é¢¨æ ¼ API ç¤ºæ„

é€™æ˜¯ä¸€å€‹å°ˆé–€ç”¨ä¾†ã€Œ**æ•™åŸ·è¡Œç·’åŒæ­¥**ã€çš„äº’å‹•å¼ç¶²é å·¥å…·ã€‚  
å®ƒæŠŠ Mutexã€Semaphore åœ¨å¤šåŸ·è¡Œç·’ç³»çµ±è£¡çš„è¡Œç‚ºï¼Œç”¨è¦–è¦ºåŒ– + æŒ‰éˆ•æ“ä½œåšæˆã€Œå¯ä»¥ç©ã€çš„ Demoã€‚

ç•«é¢ä¸­åŒ…å«ä¸‰å¤§å€å¡Šï¼š

1. ğŸ”’ **Mutex äº’å‹•é«”é©—**ï¼šæ‰‹å‹•æŒ‰ `k_mutex_lock()` / `k_mutex_unlock()` / `counter++`
2. ğŸ“¡ **Semaphore ç¤ºç¯„ Aï¼šISR â†’ åŸ·è¡Œç·’é€šçŸ¥**ï¼ˆ`k_sem_give()` in ISRï¼‰
3. ğŸ¯ **Semaphore ç¤ºç¯„ Bï¼šè³‡æºæ± ï¼ˆæœ€å¤š 3 å€‹è³‡æºï¼‰**

å¦å¤–é‚„æœ‰ä¸€å€‹ **Semaphore vs Mutex æ¯”è¼ƒè¡¨**ï¼Œå¹«ä½ æ•´ç†ã€Œåˆ°åº•è¦ç”¨å“ªä¸€å€‹ã€ã€‚

é©åˆæ‹¿ä¾†ï¼š

- è‡ªå·±å­¸ç¿’ OS / RTOS ä¸­çš„ thread synchronization
- è§£é‡‹ Zephyr / FreeRTOS / POSIX çš„åŒæ­¥æ¦‚å¿µ
- ä¸Šèª²ã€å…§è¨“ã€æŠ€è¡“åˆ†äº«çš„ live demo

---

## ğŸ”— Demo


- GitHub Pagesï¼š  
  `https://catdogbird3.github.io/Thread-Synchronization-Interactive-Lab/`

---

## âœ¨ Features Â· åŠŸèƒ½ç‰¹è‰²

### 1. ğŸ”’ Mutex äº’å‹•é«”é©—ï¼šæ‰‹å‹•æ§åˆ¶ Lock/Unlock

- å…©å€‹åŸ·è¡Œç·’ï¼š**åŸ·è¡Œç·’ 1**ã€**åŸ·è¡Œç·’ 2**
- æ¯å€‹åŸ·è¡Œç·’æœ‰è‡ªå·±çš„ï¼š
  - ç‹€æ…‹ï¼ˆIdle / æŒæœ‰é–ï¼‰
  - å€‹äººè¨ˆæ•¸ï¼ˆå€‹äºº counterï¼‰
- ä¸­å¤®æœ‰ä¸€å€‹ **å…±äº«è¨ˆæ•¸å™¨ `Shared Counter`**
- ä½¿ç”¨ Zephyr é¢¨æ ¼ API æ¦‚å¿µï¼š
  - `k_mutex_lock()`
  - `k_mutex_unlock()`
  - è‡¨ç•Œå€è£¡åŸ·è¡Œ `counter++`

**äº’å‹•è¡Œç‚ºï¼š**

- âœ… æœ‰é–‹ Mutex æ¨¡å¼ï¼š
  - ä¸€æ¬¡åªæœ‰ä¸€å€‹åŸ·è¡Œç·’èƒ½æˆåŠŸ `k_mutex_lock()`
  - èª° lock èª°æ‰èƒ½ unlockï¼ˆæ“æœ‰æ¬ŠåŸå‰‡ï¼‰
  - æœªæŒæœ‰é–å˜—è©¦ `counter++` æœƒè¢«æ‹’çµ•ï¼Œlog é¡¯ç¤ºéŒ¯èª¤
- âŒ ä¸ä½¿ç”¨ Mutex æ¨¡å¼ï¼š
  - æ¨¡æ“¬ Race Condition
  - å…©å€‹åŸ·è¡Œç·’å¯èƒ½ã€Œå…ˆè®€åˆ°åŒæ¨£çš„ `counter` å€¼ï¼Œå†å„è‡ª +1 å¯«å›å»ã€
  - ç•¶åµæ¸¬åˆ°ã€Œå…©å€‹åŸ·è¡Œç·’è®€åˆ°åŒå€¼ã€ï¼Œæœƒè·³å‡º Race Condition è­¦å‘Š + ç´…å­— log

---

### 2. ğŸ“¡ Semaphore ç¤ºç¯„ Aï¼šISR â†’ åŸ·è¡Œç·’é€šçŸ¥

**æƒ…å¢ƒï¼š**

- Timer ISR æ¯éš”ä¸€æ®µæ™‚é–“è§¸ç™¼ä¸€æ¬¡ï¼Œæ¨¡æ“¬ï¼š
  - æ„Ÿæ¸¬å™¨å®Œæˆå–æ¨£
  - å®šæ™‚äº‹ä»¶
  - ç¡¬é«”ä¸­æ–·

**é‡é»æ¦‚å¿µï¼š**

- ISR å‘¼å« `k_sem_give()` âœ…ï¼ˆSemaphore å¯ä»¥åœ¨ ISR ä½¿ç”¨ï¼‰
- Worker Thread ç”¨ `k_sem_take()` ç­‰å¾…é€šçŸ¥
- çœŸæ­£çš„ heavy work æ”¾åœ¨åŸ·è¡Œç·’ç«¯åšï¼Œè€Œä¸æ˜¯å¡åœ¨ ISR è£¡

**è¦–è¦ºæ•ˆæœï¼š**

- `Timer ISR` å¡ç‰‡æœƒçŸ­æš«è®Šæˆã€Œworkingã€ä¸¦é¡¯ç¤ºã€ŒğŸ”” ç™¼å‡ºé€šçŸ¥ã€
- `å·¥ä½œåŸ·è¡Œç·’` æ”¶åˆ°ä¿¡è™Ÿå¾Œè®Šç‚ºã€Œè™•ç†ä¸­ã€ï¼Œè™•ç†å®Œå†å›åˆ°ã€Œç­‰å¾…é€šçŸ¥ã€
- ä¸‹æ–¹è¨ˆæ•¸å™¨é¡¯ç¤ºã€Œå·²è™•ç†å–æ¨£: Nã€
- Log å€ç´€éŒ„ï¼š
  - ISRï¼š`k_sem_give()`
  - Workerï¼š`k_sem_take()` æˆåŠŸ
  - æ¯æ¬¡è™•ç†å®Œæˆæ™‚çš„ç¸½æ•¸

---

### 3. ğŸ¯ Semaphore ç¤ºç¯„ Bï¼šè³‡æºæ± ï¼ˆCounting Semaphoreï¼‰

**æƒ…å¢ƒï¼š**

- ç³»çµ±åŒæ™‚æœ€å¤šå…è¨± **3 å€‹è³‡æº** è¢«å ç”¨ï¼Œä¾‹å¦‚ï¼š
  - 3 å€‹ DMA buffer
  - 3 å€‹ socket / connection
  - 3 å€‹ç¡¬é«”é€šé“

**ä»‹é¢è¡Œç‚ºï¼š**

- ä¸Šæ–¹æœ‰ 3 å€‹æ–¹å¡Šï¼ˆè³‡æºæ§½ï¼‰ï¼Œç‹€æ…‹ï¼š
  - ç¶ è‰²ï¼šå¯ç”¨ï¼ˆavailableï¼‰
  - ç´…è‰²ï¼šè¢«ä½”ç”¨ï¼ˆtakenï¼‰
- ä¸‹æ–¹é¡¯ç¤ºï¼š`å¯ç”¨è³‡æº: X / 3`
- æŒ‰éˆ•ï¼š
  - `ğŸ”½ å–å¾—è³‡æº (take)` â†’ æ¨¡æ“¬ `k_sem_take()`
  - `ğŸ”¼ é‡‹æ”¾è³‡æº (give)` â†’ æ¨¡æ“¬ `k_sem_give()`
  - `ğŸ”„ é‡ç½®` â†’ é‡ç½®è³‡æºæ± 

**è¡Œç‚ºé‚è¼¯ï¼š**

- å¦‚æœé‚„æœ‰è³‡æºï¼š
  - `take` æˆåŠŸ â†’ å¯ç”¨æ•¸é‡ -1 â†’ æœ‰ log è¨˜éŒ„
- å¦‚æœæ²’è³‡æºï¼š
  - `take` é¡¯ç¤ºã€Œç­‰å¾…ä¸­ã€çš„ logï¼ˆçœŸå¯¦ RTOS æœƒ block åŸ·è¡Œç·’ï¼‰
- å¦‚æœè³‡æºå·²æ»¿é‚„ `give`ï¼š
  - é¡¯ç¤ºã€Œå·²é”æœ€å¤§å€¼ã€çš„è­¦å‘Š

---

### 4. ğŸ“Š Semaphore vs Mutex æ¯”è¼ƒè¡¨

ç¶²é åº•éƒ¨æœ‰ä¸€å€‹æ•´ç†å¥½çš„å°ç…§è¡¨ï¼Œé‡é»åŒ…æ‹¬ï¼š

- æœ¬è³ªï¼š
  - Semaphoreï¼šè¨ˆæ•¸å™¨ï¼ˆå¯è¨­å®šæœ€å¤§å€¼ï¼‰
  - Mutexï¼šä¸€æŠŠé–ï¼Œä¸€æ¬¡åªæœ‰ä¸€å€‹ owner
- æ“æœ‰æ¬Šï¼š
  - Semaphoreï¼šç„¡æ“æœ‰è€…ï¼ŒA takeã€B ä¹Ÿèƒ½ give
  - Mutexï¼šæœ‰æ“æœ‰è€…ï¼Œèª° lock å°±è¦èª° unlock
- ä¸»è¦ç”¨é€”ï¼š
  - Semaphoreï¼šäº‹ä»¶ / é€šçŸ¥ã€è³‡æºæ± 
  - Mutexï¼šä¿è­·è‡¨ç•Œå€ã€é¿å… Race Condition
- ISR ä½¿ç”¨ï¼š
  - `k_sem_give()` å¯åœ¨ ISR å‘¼å« âœ…
  - Mutex ä¸å¯åœ¨ ISR èª¿ç”¨ lock/unlock âŒ
- å„ªå…ˆæ¬Šåè½‰ï¼š
  - Semaphoreï¼šæ²’æœ‰å…§å»ºè™•ç†æ©Ÿåˆ¶
  - Mutexï¼šZephyr æä¾›å„ªå…ˆæ¬Šç¹¼æ‰¿
- é˜²æ­¢ Race Conditionï¼š
  - Semaphoreï¼šä¸æ˜¯ä¸»è¦ç”¨é€”
  - Mutexï¼šå°ˆé–€ç”¨ä¾†ä¿è­·å…±äº«è³‡æº

ä¸¦é™„ä¸€å€‹ç°¡çŸ­çµè«–å€ï¼Œå‘Šè¨´ä½ ï¼š

- è¦ä¿è­·å…±äº«è³‡æ–™ â†’ ç”¨ Mutex  
- è¦å¾ ISR é€šçŸ¥ Thread â†’ ç”¨ Semaphore  
- è¦é™åˆ¶åŒæ™‚ä½¿ç”¨è³‡æºæ•¸é‡ â†’ ç”¨ Counting Semaphore  

---

## ğŸ§  æ ¸å¿ƒæ¦‚å¿µç¸½çµ

### Mutexï¼ˆäº’æ–¥é–ï¼‰

- ä¸€æ¬¡åªå…è¨± **ä¸€å€‹åŸ·è¡Œç·’** é€²å…¥è‡¨ç•Œå€
- èª° `k_mutex_lock()` æˆåŠŸï¼Œå°±æˆç‚ºã€ŒæŒæœ‰è€…ã€
- åªæœ‰æŒæœ‰è€…å¯ä»¥ `k_mutex_unlock()`
- ç”¨é€”ï¼šä¿è­·å…±äº«è®Šæ•¸ï¼å…±äº«çµæ§‹å…æ–¼åŒæ™‚ä¿®æ”¹

### Semaphoreï¼ˆè¨Šè™Ÿé‡ï¼‰

1. **Binary / Event Semaphore**
   - å¸¸ç”¨åœ¨ã€Œäº‹ä»¶é€šçŸ¥ã€å ´æ™¯ï¼š
     - ISR â†’ Thread
     - Device â†’ Worker
   - `k_sem_give()`ï¼šç™¼å‡ºä¿¡è™Ÿ
   - `k_sem_take()`ï¼šç­‰å¾…ä¿¡è™Ÿ

2. **Counting Semaphore**
   - ç®¡ç†ä¸€çµ„æœ‰é™è³‡æº
   - åˆå€¼ = å¯ç”¨è³‡æºæ•¸é‡ï¼ˆä¾‹å¦‚ 3ï¼‰
   - æ¯æ¬¡ take â†’ -1ï¼›æ¯æ¬¡ give â†’ +1

> é‡é»ï¼š  
> - Mutex æ˜¯ã€Œäº’æ–¥å­˜å–ä¿è­·ã€  
> - Semaphore æ¯”è¼ƒåƒã€Œè¨ˆæ•¸å™¨ / äº‹ä»¶é€šçŸ¥ / åé¡ç®¡ç†ã€

---

## ğŸ— Tech Stack Â· æŠ€è¡“æ£§

- **HTML5**ï¼šå–®é éœæ…‹ç¶²é 
- **ç´” CSS + ä¸€é» Tailwind CDN**ï¼ˆç”¨åœ¨éƒ¨åˆ†å…ƒä»¶ï¼‰
- **åŸç”Ÿ JavaScript**ï¼š
  - ç®¡ç†ä¸‰å€‹ demo çš„ç‹€æ…‹ï¼š
    - Mutex æ¨¡å¼ & é–æ“æœ‰è€…
    - Semaphore event demo çš„ timer ç‹€æ…‹
    - Counting semaphore çš„è³‡æºè¨ˆæ•¸
  - æ›´æ–° UI / log / ç‹€æ…‹æŒ‡ç¤ºç‡ˆ

- **ç„¡å¾Œç«¯ã€ç„¡æ‰“åŒ…**ï¼š
  - ä¸éœ€è¦ Node.js / webpack / bundler
  - ç›´æ¥é–‹ `index.html` æˆ–ä¸Ÿ GitHub Pages å°±èƒ½ç”¨

---

## ğŸ“ å°ˆæ¡ˆçµæ§‹

æœ€ç°¡ç‰ˆå¯ä»¥æ˜¯ï¼š

```bash
.
â”œâ”€ index.html   # Thread Synchronization äº’å‹•æ•™å­¸ä¸»é 
â””â”€ README.md    # å°ˆæ¡ˆèªªæ˜ï¼ˆæœ¬æª”ï¼‰
